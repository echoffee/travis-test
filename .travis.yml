sudo: required
addons:
  sonarcloud:
      organization: "echoffee-github"
      token:

  apt:
    packages:
      - docker-ce

services:
        - docker

dist: trusty
language: python
python:
        - "3.3"
before_install:
        - sudo /etc/init.d/mysql stop
        - pwd
        - ls -la
        - sudo docker-compose up -d
        - docker --version
        - pip install selenium

jobs:
    include:
        - stage: tests
          script :
                - echo "Waiting a bit before pinging the containers..."
                - sleep 15
                - curl localhost:8080
                - curl localhost:4444
                - curl localhost:8081
                - echo "Starting tests..."
                - python 2test.py
                - if [ $(grep -nr '<<<<<<' . | wc -l) -gt -1 ]; then exit 1; fi
        - stage: sonar
          script :
                - sonar-scanner
